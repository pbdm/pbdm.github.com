## 数据收集

* 客户端点击进入 webview, 两种统计方式, 一种是客户端直接发打点给服务端,一种是将时间戳传给 h5



* 白屏时间：~~用户从打开页面开始到页面开始有东西呈现为止，这过程中占用的时间就是白屏时间~~
在 react 里应该是和用户可操作时间, 因为js 是在 body底部而不是 head 底部

```
<!DOCTYPE HTML>
<html>
  <head>
    <script>
      window.perf = {}
      perf.startTime = +new Date
      console.log('start', +new Date - perf.startTime);
    </script>
    <script src="example.js"></script>
    <script>
     // head里所有的 script 都下载完后才会执行
      console.log('head end', +new Date - perf.startTime);
    </script>
  </head>
  <body>
    <p>test</p>
  </body>
  <script>
    console.log('htmlend', +new Date - perf.startTime)
  </script>
</html>
```

* 首屏时间：用户浏览器首屏内所有内容都呈现出来所花费的时间
需要绑定所有图片的 load 事件, 判断图片是否在首屏显示, 取 load 最晚的值

* 用户可操作时间：用户可以进行正常的点击、输入等操作
```
document.addEventListener('DOMContentLoaded', () => {
  console.log('DOMContentLoaded', +new Date - perf.startTime)
})
```

* 页面总下载时间：页面所有资源(非异步)都加载完成并呈现出来所花的时间，即页面 onload 的时间
```
window.addEventListener('load', function() {
  console.log('onload', +new Date - perf.startTime)
  // make log here
})
```

chrome里可以使用 `performance.timing`
> http://caniuse.com/#search=timing

跳转 url 后记得要置零 `perf.startTime = +new Date`

样本量庞大,收集的时候是否需要过滤(不需要全部上报)?

运维在这里的角色?!(监控接口返回时间)

## 数据落地
基于 bi 的打点系统, (echarts)?

## 数据分析
白屏(可操作), 首屏, 总下载

## 第三方工具
> https://gtmetrix.com/
> http://www.mmtrix.com/

> http://fex.baidu.com/blog/2014/05/build-performance-monitor-in-7-days/


## 参数:
时间点 (start, headend, indexstart, indexend, htmlend, DOMContentLoaded(白屏时间), onload, api 请求时间)
距离开始时间值
页面 url
机型参数,版本
网络参数,网络供应商

## 问题

样本量庞大,收集的时候是否需要过滤?

## 报错分析
在 index.js 里用 try catch 包裹,已在线上, 需要数据分析, sourcemap
* 异步 try catch
* window.onerror (safari 里上报不全, 没有line, column, errorObject)
> http://doc.pajk-ent.com/pages/viewpage.action?pageId=24117480
> http://www.cnblogs.com/hustskyking/p/fe-monitor.html
> https://getsentry.com/welcome/
> http://rapheal.sinaapp.com/2014/11/06/javascript-error-monitor/
